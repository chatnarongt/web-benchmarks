# Web Benchmarks

An automated pipeline for benchmarking web framework competitors (currently Elysia with Node.js and Bun) inside isolated Kubernetes environments.

## Requirements

Ensure you have the following installed on your host machine:
- **Docker**: For building and running containerized environments (Docker Desktop is recommended for macOS/Windows).
- **Kubernetes**: A local running cluster (e.g., Docker Desktop's built-in Kubernetes, Minikube, or kind).
- **Bun**: The JavaScript runtime/toolkit used to run the orchestration script.
- **kubectl**: CLI tool configured to communicate with your local Kubernetes cluster.
- *(Note: You do NOT need `hey` or competitors' dependencies installed globally, as testing happens inside containers).*

## Configuration

The benchmarking pipeline is controlled by `bench.config.yml` at the root of the project:

```yaml
competitors:
  - elysia-js-with-bun
  - elysia-js-with-node
concurrency: 1 # Controls if competitors run sequentially (1) or concurrently
test_time_in_minutes: 1 # Duration of each test. Recommended: 10
resources:
  requests:
    cpu: "0.25"
    memory: "64Mi"
  limits:
    cpu: "0.5"
    memory: "512Mi"
```

To add a new framework to test, simply create a new directory inside `competitors/` containing the source and a valid `Dockerfile`, and then add its directory name to the `competitors` list.

## Usage

Start the automated benchmarking process by simply running:

```bash
bun run start
```

This command will automatically:
1. Parse `bench.config.yml`.
2. Build the Docker image for the first competitor.
3. Deploy it to Kubernetes with the requested resource limits.
4. Launch a temporary `hey` pod to simulate heavy traffic against the deployment's service.
5. Extract and parse the results.
6. Delete the deployment and move to the next competitor.
7. Generate a final `report.json` with the consolidated metrics.

### Cleaning Up

If a test fails mid-run or you want to abruptly abort, you might be left with orphaned Kubernetes resources. Run:

```bash
bun run clean
```

This will clear all deployments, services, and temporary files generated by the runner.
